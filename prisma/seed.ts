import { generateHash } from '../src/common/utils';
import { PrismaClient, UserRole, UserStatus } from '../src/generated/prisma';

const prisma = new PrismaClient();

async function main() {
	console.log('üå± Starting database seeding...');

	// Check if admin user already exists
	const existingAdmin = await prisma.user.findFirst({
		where: {
			id: '00000000-0000-0000-0000-000000000001',
		},
	});

	if (existingAdmin) {
		console.log('‚úÖ Admin user already exists, skipping creation...');
		console.log(`   Email: ${existingAdmin.email}`);
		console.log(`   Role: ${existingAdmin.role}`);
		console.log(`   Status: ${existingAdmin.status}`);
		return;
	}

	// Create the default admin user
	const adminPassword = 'Admin@123456'; // Change this to a secure password
	const hashedPassword = generateHash(adminPassword);

	const adminUser = await prisma.user.create({
		data: {
			id: '00000000-0000-0000-0000-000000000001', // Matches ADMIN_USER_ID constant
			email: 'admin@virtualtour.com',
			username: 'admin',
			firstName: 'System',
			lastName: 'Administrator',
			role: UserRole.SUPER_ADMIN,
			status: UserStatus.ACTIVE,
			language: 'en',
			timezone: 'UTC',
			hashedPassword,
			emailVerifiedAt: new Date(),
			lastLoginAt: null,
		},
	});

	console.log('‚úÖ Admin user created successfully!');
	console.log('üìß Login credentials:');
	console.log(`   Email: ${adminUser.email}`);
	console.log(`   Username: ${adminUser.username}`);
	console.log(`   Password: ${adminPassword}`);
	console.log(`   Role: ${adminUser.role}`);
	console.log(`   User ID: ${adminUser.id}`);
	console.log('');
	console.log('‚ö†Ô∏è  IMPORTANT: Change the default password after first login!');

	// Create some sample virtual tours for testing (optional)
	const sampleTour = await prisma.virtualTour.create({
		data: {
			title: 'Welcome Demo Tour',
			description: 'A sample virtual tour to demonstrate the platform features',
			location: 'Virtual Space',
			slug: 'welcome-demo-tour',
			status: 'PUBLISHED',
			difficulty: 'BEGINNER',
			category: 'demo',
			tags: ['demo', 'tutorial', 'sample'],
			thumbnailUrl:
				'https://via.placeholder.com/800x600/4F46E5/FFFFFF?text=Demo+Tour',
			metaTitle: 'Welcome Demo Tour - Virtual Tour Platform',
			metaDescription:
				'Experience our virtual tour platform with this interactive demo',
			metaKeywords: ['virtual tour', 'demo', 'tutorial'],
			allowPublicAccess: true,
			allowEmbedding: true,
			autoplayEnabled: false,
			autoplaySpeed: 2,
			viewCount: 0,
			shareCount: 0,
			bookmarkCount: 0,
			averageRating: null,
			totalRatings: 0,
			totalScenes: 1,
			totalHotspots: 0,
			estimatedDuration: 5,
			publishedAt: new Date(),
			createdById: adminUser.id,
			updatedById: adminUser.id,
		},
	});

	// Create a sample scene for the demo tour
	await prisma.scene.create({
		data: {
			title: 'Welcome Scene',
			description: 'The main welcome scene for the demo tour',
			order: 1,
			panoramaUrl:
				'https://via.placeholder.com/4096x2048/2563EB/FFFFFF?text=360¬∞+Demo+Panorama',
			thumbnailUrl:
				'https://via.placeholder.com/400x300/2563EB/FFFFFF?text=Scene+Thumbnail',
			mapPositionX: 0,
			mapPositionY: 0,
			initialViewAngle: 0,
			maxZoom: 3,
			minZoom: 0.5,
			tourId: sampleTour.id,
		},
	});

	console.log('‚úÖ Sample demo tour created successfully!');
	console.log(`   Tour ID: ${sampleTour.id}`);
	console.log(`   Title: ${sampleTour.title}`);
	console.log(`   Slug: ${sampleTour.slug}`);

	// Seed amenities data
	console.log('üè¢ Seeding amenities data...');

	const internalAmenities = [
		{
			name: 'Retail pods',
			description: 'C·ª≠a h√†ng ti·ªán √≠ch',
			category: 'internal',
			iconName: 'shopping-bag',
			imageUrl: '/demo/1.png',
			displayOrder: 1,
		},
		{
			name: 'Nh√† h√†ng',
			description: 'Nh√† h√†ng cao c·∫•p',
			category: 'internal',
			iconName: 'utensils',
			imageUrl: '/demo/2.png',
			displayOrder: 2,
		},
		{
			name: 'Cafe',
			description: 'Kh√¥ng gian th∆∞ gi√£n',
			category: 'internal',
			iconName: 'coffee',
			imageUrl: '/demo/3.png',
			displayOrder: 3,
		},
		{
			name: 'Jjimjilbang',
			description: 'Spa truy·ªÅn th·ªëng H√†n Qu·ªëc',
			category: 'internal',
			iconName: 'waves',
			imageUrl: '/demo/4.png',
			displayOrder: 4,
		},
		{
			name: 'Elite fitness',
			description: 'Ph√≤ng gym cao c·∫•p',
			category: 'internal',
			iconName: 'dumbbell',
			imageUrl: '/demo/5.png',
			displayOrder: 5,
		},
		{
			name: 'B·ªÉ b∆°i c∆∞ d√¢n',
			description: 'B·ªÉ b∆°i d√†nh ri√™ng c∆∞ d√¢n',
			category: 'internal',
			iconName: 'waves',
			imageUrl: '/demo/6.png',
			displayOrder: 6,
		},
		{
			name: 'B·ªÉ s·ª•c',
			description: 'Khu v·ª±c th∆∞ gi√£n',
			category: 'internal',
			iconName: 'waves',
			imageUrl: '/demo/7.png',
			displayOrder: 7,
		},
		{
			name: 'Gi·∫∑t s·∫•y',
			description: 'D·ªãch v·ª• gi·∫∑t s·∫•y',
			category: 'internal',
			iconName: 'home',
			imageUrl: '/demo/8.png',
			displayOrder: 8,
		},
		{
			name: 'Games',
			description: 'Khu vui ch∆°i gi·∫£i tr√≠',
			category: 'internal',
			iconName: 'gamepad2',
			imageUrl: '/demo/9.png',
			displayOrder: 9,
		},
		{
			name: 'Public lounge',
			description: 'Khu v·ª±c sinh ho·∫°t chung',
			category: 'internal',
			iconName: 'users',
			imageUrl: '/demo/10.png',
			displayOrder: 10,
		},
		{
			name: 'Th∆∞ vi·ªán',
			description: 'Kh√¥ng gian ƒë·ªçc s√°ch',
			category: 'internal',
			iconName: 'book-open',
			imageUrl: '/demo/1.png',
			displayOrder: 11,
		},
		{
			name: 'Coworking space',
			description: 'Kh√¥ng gian l√†m vi·ªác chung',
			category: 'internal',
			iconName: 'briefcase',
			imageUrl: '/demo/2.png',
			displayOrder: 12,
		},
		{
			name: 'Kids',
			description: 'Khu vui ch∆°i tr·∫ª em',
			category: 'internal',
			iconName: 'baby',
			imageUrl: '/demo/3.png',
			displayOrder: 13,
		},
		{
			name: 'B·ªÉ b∆°i Elite fitness',
			description: 'B·ªÉ b∆°i gym cao c·∫•p',
			category: 'internal',
			iconName: 'waves',
			imageUrl: '/demo/4.png',
			displayOrder: 14,
		},
		{
			name: 'S√¢n d·∫°o b·ªô',
			description: 'L·ªëi ƒëi b·ªô trong khu',
			category: 'internal',
			iconName: 'tree-pine',
			imageUrl: '/demo/5.png',
			displayOrder: 15,
		},
		{
			name: 'R·∫°p phim ngo√†i tr·ªùi',
			description: 'R·∫°p chi·∫øu phim ngo√†i tr·ªùi',
			category: 'internal',
			iconName: 'camera',
			imageUrl: '/demo/6.png',
			displayOrder: 16,
		},
		{
			name: 'B·ªÉ b∆°i b·ªën m√πa',
			description: 'B·ªÉ b∆°i ho·∫°t ƒë·ªông c·∫£ nƒÉm',
			category: 'internal',
			iconName: 'waves',
			imageUrl: '/demo/7.png',
			displayOrder: 17,
		},
		{
			name: 'B·ªÉ b∆°i ngo√†i tr·ªùi',
			description: 'B·ªÉ b∆°i ngo√†i tr·ªùi',
			category: 'internal',
			iconName: 'waves',
			imageUrl: '/demo/8.png',
			displayOrder: 18,
		},
	];

	const externalAmenities = [
		{
			name: 'CLB gi·∫£i tr√≠ ven bi·ªÉn Sailing Club',
			description: 'C√¢u l·∫°c b·ªô ven bi·ªÉn',
			category: 'external',
			iconName: 'anchor',
			imageUrl: '/demo/9.png',
			displayOrder: 1,
		},
		{
			name: 'Retail pods',
			description: 'C·ª≠a h√†ng ngo√†i khu',
			category: 'external',
			iconName: 'shopping-bag',
			imageUrl: '/demo/10.png',
			displayOrder: 2,
		},
		{
			name: 'H·ªì b∆°i trong nh√†',
			description: 'B·ªÉ b∆°i trong nh√†',
			category: 'external',
			iconName: 'waves',
			imageUrl: '/demo/1.png',
			displayOrder: 3,
		},
		{
			name: 'Nh√† h√†ng',
			description: 'Nh√† h√†ng khu ngo·∫°i',
			category: 'external',
			iconName: 'utensils',
			imageUrl: '/demo/2.png',
			displayOrder: 4,
		},
		{
			name: 'Khu t√°c ph·∫©m ngh·ªá thu·∫≠t',
			description: 'Tri·ªÉn l√£m ngh·ªá thu·∫≠t',
			category: 'external',
			iconName: 'palette',
			imageUrl: '/demo/3.png',
			displayOrder: 5,
		},
		{
			name: 'Qu·∫£ng tr∆∞·ªùng bi·ªÉn',
			description: 'Qu·∫£ng tr∆∞·ªùng ven bi·ªÉn',
			category: 'external',
			iconName: 'building',
			imageUrl: '/demo/4.png',
			displayOrder: 6,
		},
		{
			name: 'C·∫ßu c·∫£nh quan',
			description: 'C·∫ßu ng·∫Øm c·∫£nh',
			category: 'external',
			iconName: 'building',
			imageUrl: '/demo/5.png',
			displayOrder: 7,
		},
		{
			name: 'Trung t√¢m th∆∞∆°ng m·∫°i',
			description: 'Khu mua s·∫Øm l·ªõn',
			category: 'external',
			iconName: 'shopping-bag',
			imageUrl: '/demo/6.png',
			displayOrder: 8,
		},
		{
			name: 'H·ªì b∆°i ngo√†i tr·ªùi',
			description: 'B·ªÉ b∆°i ngo√†i khu',
			category: 'external',
			iconName: 'waves',
			imageUrl: '/demo/7.png',
			displayOrder: 9,
		},
		{
			name: 'Pool bar',
			description: 'Qu·∫ßy bar b·ªÉ b∆°i',
			category: 'external',
			iconName: 'coffee',
			imageUrl: '/demo/8.png',
			displayOrder: 10,
		},
		{
			name: 'Khu BBQ',
			description: 'Khu n∆∞·ªõng BBQ',
			category: 'external',
			iconName: 'utensils',
			imageUrl: '/demo/9.png',
			displayOrder: 11,
		},
		{
			name: 'R·∫°p chi·∫øu phim ngo√†i tr·ªùi',
			description: 'R·∫°p phim ngo√†i khu',
			category: 'external',
			iconName: 'camera',
			imageUrl: '/demo/10.png',
			displayOrder: 12,
		},
		{
			name: 'H√≠ tr∆∞·ªùng bi·ªÉn',
			description: 'Nh√† h√°t ven bi·ªÉn',
			category: 'external',
			iconName: 'music',
			imageUrl: '/demo/1.png',
			displayOrder: 13,
		},
		{
			name: 'H·ªì nh·∫°c n∆∞·ªõc',
			description: 'ƒê√†i phun n∆∞·ªõc nh·∫°c',
			category: 'external',
			iconName: 'music',
			imageUrl: '/demo/2.png',
			displayOrder: 14,
		},
	];

	// Create amenities
	const allAmenities = [...internalAmenities, ...externalAmenities];

	for (const amenityData of allAmenities) {
		// Check if amenity already exists
		const existingAmenity = await prisma.amenity.findFirst({
			where: {
				name: amenityData.name,
				category: amenityData.category,
			},
		});

		if (!existingAmenity) {
			await prisma.amenity.create({
				data: amenityData,
			});
		}
	}

	// Update the sample tour with apartment metadata
	await prisma.virtualTour.update({
		where: { id: sampleTour.id },
		data: {
			apartmentMetadata: {
				type: {
					id: 'studio',
					name: 'Studio',
					unitCount: 1496,
					areaRange: '29.2 - 35 m¬≤',
					description: 'CƒÉn h·ªô studio hi·ªán ƒë·∫°i',
					hasSubLevels: false,
					expectedHotspots: ['Ph√≤ng kh√°ch', 'Toilet'],
				},
				specifications: {
					bedrooms: 0,
					bathrooms: 1,
					area: 32,
					floor: '15',
					view: 'City View',
					balcony: true,
				},
			},
		},
	});

	console.log('‚úÖ Amenities seeded successfully!');
	console.log(`   Internal amenities: ${internalAmenities.length}`);
	console.log(`   External amenities: ${externalAmenities.length}`);
	console.log('');
	console.log('üéâ Database seeding completed successfully!');
}

main()
	.catch((e) => {
		console.error('‚ùå Error during seeding:');
		console.error(e);
		process.exit(1);
	})
	.finally(async () => {
		await prisma.$disconnect();
	});
